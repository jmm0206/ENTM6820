---
title: "Reproducible Workflow Code"
author: "Jordan Melson"
date: "2023-04-17"
output: html_document
---
## Code
The data for this project is 8 weeks worth of crape myrtle bark scale population counts from CMBS infested crape myrtles in the greenhouse. Adult and Crawler counts were taken weekly over 2 months on 36 trees with 6 different treatments. All data are physical, in-situ counts, taken by hand. CMBS adults and crawlers were counted on 10 cm of 3 random branches. The goal of the experiment was to determine if limonene, a botanical, had similar or better control of CMBS than common chemical insecticides including pyriproxifen, dinotefuran, and imidacloprid, as well as a water treatment and a non-treated control. Based on previous unpublished data, we hypothesize that limonene will meet or exceed our expectations for the control of CMBS.
```{r}
library(tidyverse)
library(emmeans)
library(multcomp)
library(multcompView)

LimoR <- read.csv('LimoR.csv')

anova(lm(Total~Trt, data = LimoR))

lm.trt <- lm(Total ~ Trt, data = LimoR)
summary(lm.trt)

lsmeans <- emmeans(lm.trt, ~Trt)

Results_lsmeans <- multcomp::cld(lsmeans, alpha = 0.05, reversed = TRUE, details = TRUE)
Results_lsmeans

anova <- aov(Total ~ Trt, data = LimoR)
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova,tukey)

dt <- group_by(LimoR, Trt) %>%
  summarise(w=mean(Total), sd = sd(Total)) %>%
  arrange(desc(w))

cld <- as.data.frame.list(cld$Trt)
dt$cld <- cld$Letters

print(dt)
```

## Analysis
Treatment did have a significant effect on the total number of CMBS on the crape myrtles (p=0.0006). Limonene is not significantly different from dinotefuran or water but is the only of those treatments that is significantly different from the other treatments (imidacloprid, pyriproxifen, and control).
```{r}
library(ggplot2)
LC <- scale_color_discrete(name="Treatment",
                         breaks=c("Control", "Dino", "Imid", "Limo", "Pyri",
                                  "Water"),
                         labels=c("Control", "Dinotefuran", "Imidicloprid",
                                  "Limonene", "Pyriproxifen", "Water"))

ggplot(LimoR, aes(x = Date, y = Total, group = Trt, color = Trt)) +
  stat_summary(geom ="line")+
  labs(x = "Week", y = "Avg Total CMBS", title = "Average Population of CMBS over
       Time")+
  LC

ggplot(LimoR, aes(x = Date, y = Total, group = Trt, color = Trt)) +
  geom_smooth(method = lm, se = FALSE)+
  geom_point()+
  labs(x = "Week", y = "Avg Total CMBS", title = "Linear Regression of Average
  Population of CMBS over Time")+
  LC

ggplot(LimoR, aes(x = Trt, y = Total, group = Trt, color = Trt)) +
  geom_boxplot()+
  scale_x_discrete(breaks=NULL)+
  labs(x= NULL, y = "Avg Total CMBS", title = "Comparison of Treatments")+
  LC

ggplot(dt, aes(Trt, w)) +
  geom_bar(stat = "identity", aes(fill = w), show.legend = FALSE)+
  geom_errorbar(aes(ymin = w-sd, ymax = w+sd), width = 0.2)+
  labs(x = "Treatment", y = "Avg Total CMBS", title = "Comparison of Treatment Effect on CMBS")+
  geom_text(aes(label = cld, y = w + sd), vjust = -0.5) +
  scale_x_discrete(breaks=c("Control", "Dino", "Imid", "Limo", "Pyri",
                                  "Water"),
                         labels=c("Control", "Dinotefuran", "Imidicloprid",
                                  "Limonene", "Pyriproxifen", "Water"))
```