---
title: "Data Wrangling"
author: "Jordan Melson"
date: "2023-03-23"
output: html_document
---
# Q1
Select the following columns.
OTU, SampleID, Abundance, Crop, Compartment, DateSampled, GrowthStage, Treatment, Rep,
Fungicide, Kingdom, Phylum, Class, Order, Family, Genus, Species, Taxonomy
```{r}

microbiome.fungi <- read.csv("Microbiome.csv")
library(tidyverse)
microbiome.fungi2 <- select(microbiome.fungi,
                            OTU, 
                            SampleID, 
                            Abundance, 
                            Crop, 
                            Compartment, 
                            DateSampled, 
                            GrowthStage, 
                            Treatment, 
                            Rep,
                            Fungicide, 
                            Kingdom, 
                            Phylum, 
                            Class, 
                            Order, 
                            Family, 
                            Genus, 
                            Species, 
                            Taxonomy)
```

# Q2
Calculate the mean percent relative abundance across all OTUs by compartment using the pipe operator.
```{r}
microbiome.fungi2 %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Compartment) %>%
  summarise(Mean = mean(Percent))
  
```

# Q3
Calculate the mean percent relative abundance across all OTUs by compartment and
fungicide using the pipe operator.
```{r}
microbiome.fungi2 %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Compartment, Fungicide) %>%
  summarise(Mean = mean(Percent))

```

# Q4
Restrict the previous analysis to just the fungal class Dothideomycetes.
```{r}
microbiome.fungi2 %>%
  filter(Class == "Dothideomycetes") %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Compartment, Fungicide) %>%
  summarise(Mean = mean(Percent))

```

# Q5
Now do the same analysis but for Orders in the genus Dothideomycetes.
```{r}
microbiome.fungi2 %>%
  filter(Class == "Dothideomycetes") %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Order) %>%
  summarise(Mean = mean(Percent))

```

# Q6
Calculate the standard error for each mean in Q5.
```{r}
microbiome.fungi2 %>%
  filter(Class == "Dothideomycetes") %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Order) %>%
  summarise(Mean = mean(Percent),
            n = n(),
            sd.dev = sd(Percent)) %>%
  mutate(std.err = sd.dev/sqrt(n))

```

# Q7
Select the columns Order, Compartment, Fungicide and Mean from the output of Q6 and Pivot the dataset to wide format so you have Compartment as column headers.
```{r}
microbiome.fungi2 %>%
  filter(Class == "Dothideomycetes") %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Order, Compartment, Fungicide) %>%
  summarise(Mean = mean(Percent),
            n = n(),
            sd.dev = sd(Percent)) %>%
  mutate(std.err = sd.dev/sqrt(n)) %>%
  pivot_wider(names_from = Compartment ,values_from = Mean)

```

# Q8
Recreate this plot using your dataset in Q7.
```{r}
microbiome.fungi2 %>%
  filter(Class == "Dothideomycetes") %>%
  mutate(Percent = Abundance*100) %>%
  group_by(Order,Compartment, Fungicide) %>%
  summarise(Mean = mean(Percent),
            n = n(),
            sd.dev = sd(Percent)) %>%
  mutate(std.err = sd.dev/sqrt(n)) %>%
  replace_na(list(Order = "unidentified")) %>%
  ggplot(aes(x = Mean, y = reorder (Order, Mean), fill = Fungicide)) +
  geom_bar(position='dodge', stat='identity') +
  xlab('Percent Relative Abundance')
  
  
```

